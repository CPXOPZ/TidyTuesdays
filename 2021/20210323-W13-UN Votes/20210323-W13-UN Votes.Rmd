---
title: "20210323-W13-UN Votes"
author: "CPXOPZ"
date: "2021/3/23"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages}
library(dplyr)
library(ggplot2)
remotes::install_github("davidsjoberg/ggstream")
library(ggstream)
library()
library(patchwork)
```

```{r data}
# tuesdata <- tidytuesdayR::tt_load('2021-03-23')
# tuesdata <- tidytuesdayR::tt_load(2021, week = 13)
# 
# unvotes <- tuesdata$unvotes

# Or read in the data manually

unvotes <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-03-23/unvotes.csv')
roll_calls <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-03-23/roll_calls.csv')
issues <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-03-23/issues.csv')

# save.image(here::here("2021/20210323-W13-UN Votes", "20210323-W13-UN_Votes.RData"))
```

```{r data prepare}
china <- unvotes %>% 
  left_join(roll_calls, by = "rcid") %>% 
  left_join(issues, by = "rcid") %>% 
  filter(country == "China") %>% 
  mutate(vote = factor(vote, levels = c("yes", "abstain", "no"), labels = c("Yes", "Abstain", "No")))

china_votes <- china %>% 
  group_by(vote, issue) %>% 
  count() %>% 
  tidyr::drop_na(issue)

```

```{r plot}
china %>% 
  mutate(year = lubridate::year(date)) %>% 
  count(year, vote) %>% 
  ggplot(aes(year, n, fill = vote))+
  geom_stream(show.legend = F)



UN_image <- "https://camo.githubusercontent.com/654fb54c78403255bbe1457b6a75423f5e370ee075eab4db0a189b886b68b8d7/68747470733a2f2f75706c6f61642e77696b696d656469612e6f72672f77696b6970656469612f636f6d6d6f6e732f7468756d622f652f65652f554e5f656d626c656d5f626c75652e7376672f3132303570782d554e5f656d626c656d5f626c75652e706e67"

china_votes %>% 
  # filter(vote == "")
  ggplot(aes(forcats::fct_rev(vote), n, fill = issue))+
  geom_col(position = "fill")+
  coord_flip()+
  theme(legend.position = "bottom")
  
```

